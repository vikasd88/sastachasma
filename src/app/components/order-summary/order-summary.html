<div class="order-summary-container">
  <!-- Show server order details if available, otherwise show local order details -->
  <div class="order-summary">
    <ng-container *ngIf="!loading; else loadingTemplate">
      <div *ngIf="activeOrderDetails; else errorTemplate">
        <div class="order-confirmation">
          <div class="success-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h1>Order Confirmed!</h1>
          <p class="order-id">Order #{{ activeOrderDetails.orderId }}</p>
          <p class="confirmation-message">Thank you for your purchase. We've received your order and it's being processed.</p>
          
          <div class="delivery-info">
            <h3>Estimated Delivery</h3>
            <p class="delivery-date">{{ getEstimatedDeliveryDate() }}</p>
          </div>
        </div>

        <div class="order-details">
          <h2>Order Summary</h2>
          <div class="order-items">
            <div class="order-item" *ngFor="let item of activeOrderDetails.items">
              <div class="item-image-container">
                <img [src]="getProductImage(item)" [alt]="item.name" class="item-image" (error)="$event.target.src=getProductImage(null)">
                <span class="item-quantity" *ngIf="item.quantity > 1">{{ item.quantity }}</span>
              </div>
              <div class="item-details">
                <h4>{{ item.name || 'Unknown Product' }}</h4>
                
                <!-- Frame Size (if available) -->
                <div *ngIf="item.frameSize || getFrameSize(item)" class="frame-size">
                  <span>Frame Size: {{ item.frameSize || getFrameSize(item) || 'N/A' }}</span>
                </div>
                
                <!-- Frame Price -->
                <div class="price-details">
                  <div class="price-row">
                    <span class="price-label">Frame ({{ item.quantity }} × {{ formatPrice(item.price || 0) }})</span>
                    <span class="price-amount">{{ formatPrice((item.price || 0) * item.quantity) }}</span>
                  </div>
                  
                 <!-- Lens Price (if applicable) -->
                  <div *ngIf="item.lensPrice && item.lensPrice > 0" class="price-row">
                    <span class="price-label">{{ item.lensName || 'Custom Lens' }} ({{ item.quantity }} × {{ formatPrice(item.lensPrice) }})</span>
                    <span class="price-amount">+ {{ formatPrice((item.lensPrice || 0) * (item.quantity || 1)) }}</span>
                  </div>
                  
                  <!-- Item Total -->
                  <div class="price-row item-total">
                    <strong>Item Total</strong>
                    <strong>{{ formatPrice(((item.price || 0) * item.quantity) + ((item.lensPrice || 0) * (item.quantity || 1))) }}</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="order-totals">
            <div class="total-row">
              <span>Subtotal ({{ activeOrderDetails.items.length || 0 }} items)</span>
              <span>{{ formatPrice(calculateOrderSubtotal()) }}</span>
            </div>
            <div class="total-row">
              <span>Shipping</span>
              <span>FREE</span>
            </div>
            <div class="total-row grand-total">
              <span>Total Amount</span>
              <span>{{ formatPrice(activeOrderDetails.total) }}</span>
            </div>
          </div>

          <div class="shipping-details">
            <div class="shipping-address">
              <h3>Shipping Address</h3>
              <p>{{ activeOrderDetails.shippingAddress.name }}</p>
              <p>{{ activeOrderDetails.shippingAddress.street }}</p>
              <p *ngIf="activeOrderDetails.shippingAddress.addressLine1 && activeOrderDetails.shippingAddress.addressLine1 !== activeOrderDetails.shippingAddress.street">{{ activeOrderDetails.shippingAddress.addressLine1 }}</p>
              <p *ngIf="activeOrderDetails.shippingAddress.addressLine2">{{ activeOrderDetails.shippingAddress.addressLine2 }}</p>
              <p>{{ activeOrderDetails.shippingAddress.city }}, {{ activeOrderDetails.shippingAddress.state }} {{ activeOrderDetails.shippingAddress.pincode }}</p>
              <p *ngIf="activeOrderDetails.shippingAddress.country">{{ activeOrderDetails.shippingAddress.country }}</p>
              <p *ngIf="activeOrderDetails.shippingAddress.phone">Phone: {{ activeOrderDetails.shippingAddress.phone }}</p>
            </div>
            <div class="payment-method">
              <h3>Payment Information</h3>
              <p>Method: {{ getPaymentMethod() }}</p>
              <p>Status: {{ activeOrderDetails.payment.status }}</p>
              <p *ngIf="activeOrderDetails.payment?.transactionId">
                Transaction ID: {{ activeOrderDetails.payment.transactionId || 'N/A' }}
              </p>
            </div>
          </div>

          <div class="action-buttons">
            <button (click)="continueShopping()" class="btn btn-primary">Continue Shopping</button>
            <button (click)="trackOrder()" class="btn btn-outline">Track Order</button>
          </div>
        </div>
      </div>

      <ng-template #errorTemplate>
        <div class="loading-error">
          <div class="error-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
          </div>
          <h2>Order Not Found</h2>
          <p>{{ error || 'Unable to load order details. Please try again later.' }}</p>
          <button (click)="router.navigate(['/'])" class="btn btn-primary">Back to Home</button>
        </div>
      </ng-template>
    </ng-container>

    <ng-template #loadingTemplate>
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading order details...</p>
      </div>
    </ng-template>
  </div>
</div>
