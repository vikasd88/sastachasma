<div class="order-summary-container">
  <!-- Show server order details if available, otherwise show local order details -->
  <div class="order-summary">
    <ng-container *ngIf="!loading; else loadingTemplate">
      <div *ngIf="orderDetails || localOrderDetails; else errorTemplate">
        <div class="order-confirmation">
          <div class="success-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h1>Order Confirmed!</h1>
          <p class="order-id">Order #{{ orderDetails?.orderId || localOrderDetails?.orderId }}</p>
          <p class="confirmation-message">Thank you for your purchase. We've received your order and it's being processed.</p>
          
          <div class="delivery-info">
            <h3>Estimated Delivery</h3>
            <p class="delivery-date">{{ getEstimatedDeliveryDate() }}</p>
          </div>
        </div>

        <div class="order-details">
          <h2>Order Summary</h2>
          <div class="order-items">
            <div class="order-item" *ngFor="let item of (orderDetails?.items || localOrderDetails?.items || [])">
              <img [src]="getProductImage(item)" [alt]="item.name" class="item-image">
              <div class="item-details">
                <h4>{{ item.name }} <span class="quantity">x{{ item.quantity }}</span></h4>
                
                <!-- Frame Size (if available) -->
                <div *ngIf="item.frameSize" class="frame-size">
                  <span>Frame Size: {{ item.frameSize }}</span>
                </div>
                
                <!-- Frame Price -->
                <div class="price-row">
                  <span>Frame ({{ item.quantity }}x {{ formatPrice(item.price) }})</span>
                  <span>{{ formatPrice(item.price * item.quantity) }}</span>
                </div>
                
                <!-- Lens Price (if applicable) -->
                <div *ngIf="item.lensPrice && item.lensPrice > 0" class="price-row lens-price">
                  <span>{{ item.lensName || 'Custom Lens' }} ({{ item.quantity }}x {{ formatPrice(item.lensPrice) }})</span>
                  <span>+ {{ formatPrice(item.lensPrice * item.quantity) }}</span>
                </div>
                
                <!-- Item Total -->
                <div class="price-row item-total">
                  <strong>Item Total</strong>
                  <strong>{{ formatPrice((item.price + (item.lensPrice || 0)) * item.quantity) }}</strong>
                </div>
              </div>
            </div>
          </div>

          <div class="order-totals">
            <div class="total-row">
              <span>Subtotal</span>
              <span>{{ formatPrice(orderDetails?.total || localOrderDetails?.total || 0) }}</span>
            </div>
            <div class="total-row">
              <span>Shipping</span>
              <span>FREE</span>
            </div>
            <div class="total-row grand-total">
              <span>Total</span>
              <span>{{ formatPrice(orderDetails?.total || localOrderDetails?.total || 0) }}</span>
            </div>
          </div>
        </div>

        <div class="shipping-details">
          <div class="shipping-address">
            <h3>Shipping Address</h3>
            <p>{{ (orderDetails?.shippingAddress?.name || localOrderDetails?.shippingAddress?.name || '') }}</p>
            <p>{{ (orderDetails?.shippingAddress?.street || localOrderDetails?.shippingAddress?.street || localOrderDetails?.shippingAddress?.addressLine1 || '') }}</p>
            <p>
              {{ (orderDetails?.shippingAddress?.city || localOrderDetails?.shippingAddress?.city || '') }}, 
              {{ (orderDetails?.shippingAddress?.state || localOrderDetails?.shippingAddress?.state || '') }}
            </p>
            <p>Pincode: {{ (orderDetails?.shippingAddress?.pincode || localOrderDetails?.shippingAddress?.pincode || localOrderDetails?.shippingAddress?.zipCode || '') }}</p>
            <p>Phone: {{ orderDetails?.shippingAddress?.phone || '' }}</p>
          </div>
          <div class="payment-method">
            <h3>Payment Method</h3>
            <p>{{ getPaymentMethod() }}</p>
          </div>
        </div>

        <div class="action-buttons">
          <button (click)="continueShopping()" class="btn btn-primary">Continue Shopping</button>
          <button (click)="trackOrder()" class="btn btn-outline">Track Order</button>
        </div>
      </div>

      <ng-template #errorTemplate>
        <div class="loading-error">
          <div class="error-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
          </div>
          <h2>Order Not Found</h2>
          <p>{{ error || 'Unable to load order details. Please try again later.' }}</p>
          <button (click)="router.navigate(['/'])" class="btn btn-primary">Back to Home</button>
        </div>
      </ng-template>
    </ng-container>

    <ng-template #loadingTemplate>
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading order details...</p>
      </div>
    </ng-template>
  </div>
</div>
